var Shader=function(){function r(r){return"[object Array]"==Object.prototype.toString.call(r)}function t(r){return"[object Number]"==Object.prototype.toString.call(r)}function e(r,t){var e=gl.createShader(r);if(gl.shaderSource(e,t),gl.compileShader(e),!gl.getShaderParameter(e,gl.COMPILE_STATUS))throw"compile error: "+gl.getShaderInfoLog(e);return e}function o(r,t){if(this.vertexAttribute=null,this.texCoordAttribute=null,this.program=gl.createProgram(),r=r||a,t=t||l,t="precision highp float;"+t,gl.attachShader(this.program,e(gl.VERTEX_SHADER,r)),gl.attachShader(this.program,e(gl.FRAGMENT_SHADER,t)),gl.linkProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS))throw"link error: "+gl.getProgramInfoLog(this.program)}var a="    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",l="    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }";return o.prototype.destroy=function(){gl.deleteProgram(this.program),this.program=null},o.prototype.uniforms=function(e){gl.useProgram(this.program);for(var o in e)if(e.hasOwnProperty(o)){var a=gl.getUniformLocation(this.program,o);if(null!==a){var l=e[o];if(r(l))switch(l.length){case 1:gl.uniform1fv(a,new Float32Array(l));break;case 2:gl.uniform2fv(a,new Float32Array(l));break;case 3:gl.uniform3fv(a,new Float32Array(l));break;case 4:gl.uniform4fv(a,new Float32Array(l));break;case 9:gl.uniformMatrix3fv(a,!1,new Float32Array(l));break;case 16:gl.uniformMatrix4fv(a,!1,new Float32Array(l));break;default:throw"dont't know how to load uniform \""+o+'" of length '+l.length}else{if(!t(l))throw'attempted to set uniform "'+o+'" to invalid value '+(l||"undefined").toString();gl.uniform1f(a,l)}}}return this},o.prototype.textures=function(r){gl.useProgram(this.program);for(var t in r)r.hasOwnProperty(t)&&gl.uniform1i(gl.getUniformLocation(this.program,t),r[t]);return this},o.prototype.drawRect=function(r,t,e,o){var a=gl.getParameter(gl.VIEWPORT);t=void 0!==t?(t-a[1])/a[3]:0,r=void 0!==r?(r-a[0])/a[2]:0,e=void 0!==e?(e-a[0])/a[2]:1,o=void 0!==o?(o-a[1])/a[3]:1,null==gl.vertexBuffer&&(gl.vertexBuffer=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,gl.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([r,t,r,o,e,t,e,o]),gl.STATIC_DRAW),null==gl.texCoordBuffer&&(gl.texCoordBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,gl.texCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),gl.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=gl.getAttribLocation(this.program,"vertex"),gl.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=gl.getAttribLocation(this.program,"_texCoord"),gl.enableVertexAttribArray(this.texCoordAttribute)),gl.useProgram(this.program),gl.bindBuffer(gl.ARRAY_BUFFER,gl.vertexBuffer),gl.vertexAttribPointer(this.vertexAttribute,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,gl.texCoordBuffer),gl.vertexAttribPointer(this.texCoordAttribute,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)},o.getDefaultShader=function(){return gl.defaultShader=gl.defaultShader||new o,gl.defaultShader},o}();